
# 8_Pin_Relay_Switch (PyQt5)

以 **PyQt5** 開發的桌面量測與繼電器控制工具。透過單一 GUI 介面，協調 **8-pin 繼電器切換**、**儀器量測**（DMM/SCPI）、**批次流程控制**、**即時記錄與匯出**。專為實驗室與產線的半自動化測試場景設計。

> 主要程式入口：`src/gui_main.py`  
> 關聯模組：`input_dialog.py`（操作員輸入）、`relay.py`（繼電器控制）、`dmm.py`（量測儀介面）、`meas_runner.py`（量測工作緒）、`logger.py`（紀錄）

---

## 目錄
- 專案特色
- 核心架構與模組職責
- GUI 功能（`gui_main.py`）
- 典型操作流程
- 安裝與執行（開發模式）
- 設定與參數
- 資料輸出與檔案結構
- 錯誤處理與可靠性設計
- 擴充性
- 目錄結構範例
- 履歷摘要（對外介紹重點）
- 授權與版權
- 參考

---

## 專案特色
- **Start 前強制驗證**：內建 InputDialog，在開始量測前必須通過 OPID/MO/PN 檢核（OPID=7、PN=14、皆英數；MO=英數）。
- **單窗整合**：繼電器通道、儀器連線、量測控制、狀態監看與匯出，全在一個 PyQt5 視窗完成。
- **非阻塞架構**：UI 與量測工作緒分離（`QThread` + signals/slots），長時間量測不鎖住介面。
- **批次量測**：依選定通道序列自動切換→量測→記錄，可設定重試/跳過策略。
- **可視化狀態**：通道高亮、進度列、剩餘時間估算、即時 log。
- **穩定安全**：斷線/超時/切換失敗均有提示與回復機制，支援防彈跳與切換延遲。
- **資料友善**：結果匯出 CSV，log 檔案與 UI 同步顯示，便於後續分析與追溯。

---

## 核心架構與模組職責
- **`gui_main.py`**  
  主視窗與流程協調器：管理 UI 控件、啟停量測、接收工作緒 signals、更新狀態與進度、寫入結果與 log。
- **`meas_runner.py`**  
  量測工作緒（`QThread`）：依序執行「繼電器切換 → 儀器量測 → 回報結果」，遇異常依策略重試或跳過。
- **`relay.py`**  
  繼電器抽象介面：提供 8-pin 通道切換 API，支援延遲、防彈跳，以及不同驅動介面（如 Serial/USB/GPIO）。
- **`dmm.py`**  
  量測儀介面（SCPI 等）：封裝電壓/電流/電阻等量測函式，提供初始連線、驗證、量測與斷線。
- **`logger.py`**  
  記錄系統：檔案與 UI 雙通道 log（INFO/WARN/ERROR），可選旋轉歸檔，搭配時間戳與動作標記。

> 架構重點：**signals/slots** 嚴格界面更新、**工作緒負責 I/O**；避免在 UI 執行緒做阻塞性操作。

---

## GUI 功能（`gui_main.py`）
- **儀器連線區**：設定 IP/COM/資源字串、按下 *Connect*/*Disconnect*、即時顯示連線狀態與錯誤。
- **通道面板（8-pin）**：單選/多選、批次序列；顯示目前通道，支援切換延遲與防彈跳。
- **量測控制**：*Start / Stop / Pause / Resume*；顯示總進度、剩餘時間估算、當前步驟。
- **結果區**：即時表格/列表呈現各通道量測值（含單位、時間戳），支援快速匯出。
- **log 視窗**：顯示流程訊息與錯誤，支援等級過濾與搜尋。

---

## 典型操作流程
1. **設定連線**：填入儀器參數 → 按 *Connect* → 顯示「Connected」。
2. **選通道**：勾選欲測之 pin（或載入預設序列）。
3. **設定量測**：選擇量測模式（V/I/R）、採樣數、間隔、重試次數/超時、切換延遲。
4. **開始量測**：按 *Start* → 依序切換通道、量測、回寫結果與 log。
5. **監看與控管**：進度與狀態即時更新；可 *Pause* 或 *Stop*；例外自動重試或跳過。
6. **匯出**：完成後匯出 CSV；log 自動保存於 `logs/`。

---

## 安裝與執行（開發模式）
> 本專案的 `requirements.txt` 通常 **不含** `PyQt5 / pyinstaller`；開發時請另外安裝 PyQt5。

```bash
# 建議使用虛擬環境
python -m venv .venv
# Windows
.venv\Scripts\activate
# macOS/Linux
source .venv/bin/activate

# 安裝相依套件（不含 GUI/打包）
pip install -r requirements.txt

# 安裝 PyQt5 以便執行 GUI
pip install PyQt5

# 啟動 GUI（請依你的路徑調整）
python src/gui_main.py
